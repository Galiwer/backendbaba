# Railway Internal Communication Setup

This guide explains how to set up your Ballerina backend to communicate with Railway MySQL using internal networking.

## 🏗️ Architecture

```
┌─────────────────┐    Internal Network    ┌─────────────────┐
│   Ballerina     │◄─────────────────────►│   Railway       │
│   Backend       │                       │   MySQL         │
│   (Railway)     │                       │   (Railway)     │
└─────────────────┘                       └─────────────────┘
```

## 🚀 Setup Steps

### 1. Create MySQL Service on Railway

1. Go to your Railway dashboard
2. Click "New Service"
3. Select "MySQL"
4. Railway will automatically create the database

### 2. Deploy Your Backend

1. Link your backend project to Railway:
   ```bash
   railway link
   ```

2. Deploy your backend:
   ```bash
   railway up
   ```

### 3. Connect Services

1. In Railway dashboard, go to your backend service
2. Click "Variables" tab
3. Railway automatically injects these variables:
   ```
   MYSQL_HOST=mysql.railway.internal
   MYSQL_PORT=3306
   MYSQL_USER=root
   MYSQL_PASSWORD=<auto-generated>
   MYSQL_DATABASE=railway
   ```

## 🔧 How It Works

### Internal Hostname
- Railway uses `mysql.railway.internal` for internal communication
- This hostname is only accessible within Railway's internal network
- No external network exposure required

### Automatic Configuration
- Railway automatically sets environment variables
- Your Ballerina app detects Railway environment
- Database connection uses internal networking

### Security Benefits
- ✅ No external network exposure
- ✅ Internal service discovery
- ✅ Automatic SSL termination
- ✅ Network isolation

## 🧪 Testing Internal Connection

1. **Check Environment Variables**:
   ```bash
   railway logs
   ```
   Look for: `MYSQL_HOST=mysql.railway.internal`

2. **Test Database Connection**:
   ```bash
   curl https://your-app.railway.app/health
   ```

3. **Test API Endpoints**:
   ```bash
   ./test-railway-deployment.sh https://your-app.railway.app
   ```

## 🔍 Troubleshooting

### Connection Issues
- Verify both services are in the same Railway project
- Check that MySQL service is running
- Ensure environment variables are set correctly

### Performance
- Internal communication is typically faster than external
- No bandwidth charges for internal traffic
- Railway handles load balancing automatically

### Logs
- Check Railway logs for connection details
- Monitor database connection status
- Verify service discovery is working

## 📊 Benefits

| Aspect | External Connection | Internal Connection |
|--------|-------------------|-------------------|
| Security | ⚠️ Exposed to internet | ✅ Internal only |
| Performance | 🐌 Network latency | ⚡ Direct connection |
| Cost | 💰 Bandwidth charges | 🆓 No charges |
| Reliability | 🌐 Network dependent | 🏠 Railway managed |

## 🎯 Best Practices

1. **Always use internal communication** when both services are on Railway
2. **Monitor logs** for connection status
3. **Test thoroughly** after deployment
4. **Use Railway's health checks** for monitoring
5. **Keep services in the same project** for optimal performance
